<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA Pro Analytics</title>
    <style>
        /* --- CSS BAÅžLANGIÃ‡ --- */
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --accent-color: #C9082A;
            --secondary-color: #17408B;
            --gold: #FDB927;
        }

        body { margin: 0; font-family: 'Segoe UI', Roboto, sans-serif; background-color: var(--bg-color); color: var(--text-color); overflow-x: hidden; }

        /* HEADER */
        header { display: flex; justify-content: space-between; align-items: center; padding: 15px 30px; background-color: var(--card-bg); border-bottom: 3px solid var(--accent-color); position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 20px rgba(0,0,0,0.5); }
        .header-logo { font-weight: 900; font-size: 1.4rem; color: #fff; letter-spacing: 1px; }
        .header-logo span { color: var(--accent-color); }
        nav button { background: none; border: none; color: #aaa; margin: 0 5px; font-size: 0.9rem; cursor: pointer; text-transform: uppercase; font-weight: 700; padding: 8px 10px; transition: 0.3s; border-radius: 4px; }
        nav button:hover, nav button.active { color: #fff; background: rgba(255,255,255,0.1); }
        nav button.active { border-bottom: 3px solid var(--accent-color); }
        .lang-btn { background: #333; color: white; border: 1px solid #555; padding: 5px 12px; border-radius: 20px; cursor: pointer; font-size: 0.8rem; font-weight: bold; }

        /* Ä°Ã‡ERÄ°K */
        main { padding: 20px; max-width: 1200px; margin: 0 auto; min-height: 80vh; }
        .section-content { display: none; animation: fadeIn 0.5s ease-out; }
        .section-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* HABER TASARIMI */
        .hero-section {
            position: relative; height: 400px; border-radius: 12px; overflow: hidden; margin-bottom: 30px; 
            background-size: cover; background-position: center; display: flex; align-items: flex-end; cursor: pointer;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); transition: transform 0.3s;
        }
        .hero-section:hover { transform: scale(1.01); }
        .hero-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to top, rgba(0,0,0,1) 0%, rgba(0,0,0,0) 60%); }
        .hero-content { position: relative; z-index: 2; padding: 30px; max-width: 800px; }
        .hero-tag { background: var(--accent-color); padding: 5px 10px; font-weight: bold; font-size: 0.8rem; border-radius: 4px; display: inline-block; margin-bottom: 10px; }
        .hero-title { font-size: 2.2rem; font-weight: 800; margin: 0; line-height: 1.1; text-shadow: 2px 2px 4px #000; }

        .news-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .news-card { background: var(--card-bg); border-radius: 10px; overflow: hidden; cursor: pointer; transition: 0.3s; border: 1px solid #333; display: flex; flex-direction: column; }
        .news-card:hover { transform: translateY(-5px); border-color: var(--secondary-color); }
        .news-img { width: 100%; height: 180px; object-fit: cover; }
        .news-body { padding: 20px; flex: 1; display: flex; flex-direction: column; }
        .news-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 10px; line-height: 1.3; }
        .news-meta { margin-top: auto; font-size: 0.8rem; color: #888; display: flex; justify-content: space-between; }

        /* MODAL (POPUP) TASARIMI */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9);
            z-index: 2000; display: none; justify-content: center; align-items: center; padding: 20px;
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: var(--card-bg); max-width: 800px; width: 100%; border-radius: 12px; overflow: hidden;
            box-shadow: 0 0 30px rgba(0,0,0,0.8); position: relative; animation: popIn 0.3s ease-out;
        }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-close { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.5); color: white; border: none; font-size: 1.5rem; cursor: pointer; width: 40px; height: 40px; border-radius: 50%; z-index: 10; }
        .modal-img { width: 100%; height: 350px; object-fit: cover; }
        .modal-body { padding: 30px; }
        .modal-title { font-size: 1.8rem; font-weight: bold; margin-bottom: 15px; color: var(--gold); }
        .modal-desc { font-size: 1.1rem; line-height: 1.6; color: #ddd; margin-bottom: 20px; }
        .modal-link { display: inline-block; background: var(--secondary-color); color: white; padding: 10px 25px; text-decoration: none; border-radius: 5px; font-weight: bold; }

        /* DÄ°ÄžER BÃ–LÃœMLER (Games, Stats vb.) */
        .games-grid { display: grid; gap: 20px; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); }
        .game-card { background: var(--card-bg); border-radius: 12px; overflow: hidden; border: 1px solid #333; }
        .matchup-row { display: flex; height: 100px; align-items: center; }
        .team-block { flex: 1; text-align: center; }
        .team-logo { width: 60px; height: 60px; object-fit: contain; }
        .vs-block { font-weight: 900; font-style: italic; font-size: 1.5rem; color: #555; }
        .odds-row { padding: 10px 20px; background: #252525; display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #333; }
        .prediction-badge { background: linear-gradient(45deg, var(--secondary-color), #2980b9); color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; }

        table { width: 100%; border-collapse: collapse; background: var(--card-bg); border-radius: 8px; overflow: hidden; margin-top: 15px; }
        th { background: #252525; color: #aaa; padding: 15px; text-align: left; font-size: 0.85rem; }
        td { padding: 15px; border-bottom: 1px solid #333; }
        .player-cell { display: flex; align-items: center; gap: 15px; }
        .player-headshot { width: 40px; height: 40px; border-radius: 50%; background: #333; object-fit: cover; border: 2px solid var(--accent-color); }
        .filter-btn { background: #333; border: none; color: white; padding: 8px 16px; border-radius: 20px; margin-right: 10px; cursor: pointer; }
        .filter-btn.active { background: var(--secondary-color); }
    </style>
</head>
<body>

    <div id="news-modal" class="modal-overlay" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()"> <button class="modal-close" onclick="closeModalDirect()">Ã—</button>
            <img id="modal-img" src="" class="modal-img">
            <div class="modal-body">
                <h2 id="modal-title" class="modal-title"></h2>
                <p id="modal-desc" class="modal-desc"></p>
                <a id="modal-link" href="#" target="_blank" class="modal-link">Read Full Story</a>
            </div>
        </div>
    </div>

    <header>
        <div class="header-logo">NBA <span>ANALYTICS</span></div>
        <nav>
            <button onclick="nav('home')" class="nav-btn active" id="btn-home">Home</button>
            <button onclick="nav('games')" class="nav-btn" id="btn-games">Games</button>
            <button onclick="nav('stats')" class="nav-btn" id="btn-stats">Stats</button>
            <button onclick="nav('injuries')" class="nav-btn" id="btn-injuries">Injuries</button>
            <button onclick="nav('lineups')" class="nav-btn" id="btn-lineups">Lineups</button>
        </nav>
        <button class="lang-btn" onclick="toggleLang()">EN / TR</button>
    </header>

    <main>
        <section id="home" class="section-content active">
            <div id="home-loader" style="text-align:center; padding:50px;">Loading Live News...</div>
            <div id="home-content"></div>
        </section>

        <section id="games" class="section-content">
            <h2 id="title-games">Games & Odds</h2>
            <div id="games-container" class="games-grid">
                <div style="text-align:center; padding:50px; color:#666;">Loading games...</div>
            </div>
        </section>

        <section id="stats" class="section-content">
            <h2 id="title-stats">Statistics</h2>
            <div style="margin-bottom:15px;">
                <button class="filter-btn active" onclick="loadStats('PTS')">Points</button>
                <button class="filter-btn" onclick="loadStats('AST')">Assists</button>
                <button class="filter-btn" onclick="loadStats('REB')">Rebounds</button>
            </div>
            <div class="table-container">
                <table>
                    <thead><tr><th width="10%">#</th><th width="50%">Player</th><th width="20%">Team</th><th width="20%">Value</th></tr></thead>
                    <tbody id="stats-body"></tbody>
                </table>
            </div>
        </section>

        <section id="injuries" class="section-content">
            <h2 id="title-injuries">Injury Report</h2>
            <div class="table-container">
                <table>
                    <thead><tr><th width="40%">Player</th><th width="30%">Status</th><th width="30%">Info</th></tr></thead>
                    <tbody id="injuries-body"></tbody>
                </table>
            </div>
        </section>
        
        <section id="lineups" class="section-content">
            <h2 id="title-lineups">Starting Lineups</h2>
            <p style="padding: 20px; color:#666;">Coming Soon...</p>
        </section>
    </main>

    <script>
        // --- 1. VERÄ° KAYNAKLARI VE Ã‡EVÄ°RÄ° ---
        const contentDB = {
            en: {
                nav: { home: "Home", games: "Games", stats: "Stats", injuries: "Injuries", lineups: "Lineups" },
                titles: { games: "Games & Odds", stats: "Statistics", injuries: "Injury Report", lineups: "Starting Lineups" },
                labels: { prediction: "Prediction" }
            },
            tr: {
                nav: { home: "Ana Sayfa", games: "MaÃ§lar", stats: "Ä°statistikler", injuries: "SakatlÄ±klar", lineups: "Kadrolar" },
                titles: { games: "MaÃ§lar & Beklentiler", stats: "Ä°statistikler", injuries: "SakatlÄ±k Raporu", lineups: "Ä°lk 5'ler" },
                labels: { prediction: "Tahmin" }
            }
        };

        const teamsDB = {
             'ATL': '#E03A3E', 'BOS': '#007A33', 'BKN': '#000000', 'CHA': '#1D1160', 'CHI': '#CE1141',
             'CLE': '#860038', 'DAL': '#00538C', 'DEN': '#0E2240', 'DET': '#C8102E', 'GSW': '#1D428A',
             'HOU': '#CE1141', 'IND': '#002D62', 'LAC': '#C8102E', 'LAL': '#552583', 'MEM': '#5D76A9',
             'MIA': '#98002E', 'MIL': '#00471B', 'MIN': '#0C2340', 'NOP': '#0C2340', 'NYK': '#F58426',
             'OKC': '#007AC1', 'ORL': '#0077C0', 'PHI': '#006BB6', 'PHX': '#1D1160', 'POR': '#E03A3E',
             'SAC': '#5A2D81', 'SAS': '#C4CED4', 'TOR': '#CE1141', 'UTA': '#002B5C', 'WAS': '#002B5C'
        };

        let currentLang = 'tr';
        let newsCache = []; // Haberleri hafÄ±zada tut

        // --- 2. API FONKSÄ°YONLARI ---
        async function fetchNBAData(endpoint, statCategory = 'PTS') {
            try {
                const url = `/api/nba?type=${endpoint}&category=${statCategory}&t=${Date.now()}`;
                
                // HABERLER (NEWS) XML OLARAK GELÄ°R
                if (endpoint === 'news') {
                    const response = await fetch(url);
                    const textData = await response.text();
                    
                    // XML PARSING (Browser Native)
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(textData, "text/xml");
                    const items = xmlDoc.getElementsByTagName("item");
                    
                    const newsList = [];
                    for (let i = 0; i < items.length; i++) {
                        if (i > 8) break; // Ä°lk 9 haber
                        const item = items[i];
                        const title = item.getElementsByTagName("title")[0]?.textContent || "";
                        const desc = item.getElementsByTagName("description")[0]?.textContent || "";
                        const link = item.getElementsByTagName("link")[0]?.textContent || "#";
                        
                        // Resim Ã§ekme (enclosure veya media:content)
                        let img = "https://cdn.nba.com/manage/2023/04/NBA-Playoff-Picture-2023.jpg"; // Default
                        const enclosure = item.getElementsByTagName("enclosure")[0];
                        if (enclosure) img = enclosure.getAttribute("url");
                        
                        newsList.push({ title, desc, link, img });
                    }
                    return newsList;
                }

                // DÄ°ÄžERLERÄ° JSON
                const response = await fetch(url);
                const json = await response.json();

                if (endpoint === 'stats') {
                    if(!json.resultSet || !json.resultSet.rowSet) return [];
                    const h = json.resultSet.headers;
                    const r = json.resultSet.rowSet;
                    let iName = h.indexOf('PLAYER_NAME'); if(iName===-1) iName = h.indexOf('PLAYER');
                    let iTeam = h.indexOf('TEAM_ABBREVIATION'); if(iTeam===-1) iTeam = h.indexOf('TEAM');
                    return r.slice(0, 5).map(x => ({ r: x[h.indexOf('RANK')], n: x[iName], t: x[iTeam], v: x[h.indexOf(statCategory)], i: x[h.indexOf('PLAYER_ID')] }));
                }

                if (endpoint === 'scoreboard') {
                    if(!json.scoreboard || !json.scoreboard.games) return [];
                    return json.scoreboard.games.map(g => ({
                        id: g.gameId, home: g.homeTeam.teamTricode, away: g.awayTeam.teamTricode, status: g.gameStatusText,
                        hS: 50+(Math.random()*10), aS: 50+(Math.random()*10)
                    }));
                }
                
                if (endpoint === 'injuries') return json;

                return [];
            } catch (error) {
                console.error("Fetch HatasÄ±:", error);
                return [];
            }
        }

        // --- 3. UI Ä°ÅžLEMLERÄ° ---
        document.addEventListener('DOMContentLoaded', () => { initApp(); });

        async function initApp() {
            await renderHome(); // Ã–nce haberi yÃ¼kle
            renderData(); // Arkada maÃ§larÄ± yÃ¼kle
            loadStats('PTS');
        }

        function nav(sectionId) {
            document.querySelectorAll('.section-content').forEach(el => el.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('btn-' + sectionId).classList.add('active');
        }

        function toggleLang() {
            currentLang = currentLang === 'tr' ? 'en' : 'tr';
            updateTexts();
            // Haberleri tekrar render etmeye gerek yok, zaten ingilizce geliyor genelde
        }

        function updateTexts() {
            const txt = contentDB[currentLang];
            Object.keys(txt.nav).forEach(k => { const el=document.getElementById('btn-'+k); if(el) el.innerText=txt.nav[k]; });
            Object.keys(txt.titles).forEach(k => { const el=document.getElementById('title-'+k); if(el) el.innerText=txt.titles[k]; });
        }

        // --- MODAL FONKSÄ°YONLARI ---
        function openNewsModal(index) {
            const news = newsCache[index];
            if(!news) return;

            document.getElementById('modal-img').src = news.img;
            document.getElementById('modal-title').innerText = news.title;
            document.getElementById('modal-desc').innerText = news.desc;
            document.getElementById('modal-link').href = news.link;
            
            document.getElementById('news-modal').style.display = 'flex';
        }

        function closeModal(e) {
            if (e.target.id === 'news-modal') {
                document.getElementById('news-modal').style.display = 'none';
            }
        }
        
        function closeModalDirect() {
             document.getElementById('news-modal').style.display = 'none';
        }

        // --- RENDER HOME (NEWS) ---
        async function renderHome() {
            document.getElementById('home-loader').style.display = 'block';
            const newsList = await fetchNBAData('news');
            newsCache = newsList; // Kaydet
            document.getElementById('home-loader').style.display = 'none';
            const container = document.getElementById('home-content');

            if (newsList.length === 0) {
                container.innerHTML = '<div style="text-align:center; padding:50px;">News unavailable.</div>';
                return;
            }

            // 1. ManÅŸet (Ä°lk Haber)
            const hero = newsList[0];
            const heroHTML = `
                <div class="hero-section" onclick="openNewsModal(0)" style="background-image: url('${hero.img}');">
                    <div class="hero-overlay"></div>
                    <div class="hero-content">
                        <span class="hero-tag">HEADLINE</span>
                        <h1 class="hero-title">${hero.title}</h1>
                    </div>
                </div>
            `;

            // 2. Grid (DiÄŸer Haberler)
            let gridHTML = '<div class="news-grid">';
            for (let i = 1; i < newsList.length; i++) {
                const item = newsList[i];
                gridHTML += `
                    <div class="news-card" onclick="openNewsModal(${i})">
                        <img src="${item.img}" class="news-img">
                        <div class="news-body">
                            <div class="news-title">${item.title}</div>
                            <div class="news-meta">
                                <span>ESPN NBA</span>
                                <span>Read More &rarr;</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            gridHTML += '</div>';

            container.innerHTML = heroHTML + gridHTML;
        }

        // --- DÄ°ÄžER VERÄ°LERÄ° YÃœKLE ---
        async function renderData() {
            const txt = contentDB[currentLang];
            const games = await fetchNBAData('scoreboard');
            const gCon = document.getElementById('games-container');
            gCon.innerHTML = '';

            if(games.length===0) gCon.innerHTML = '<div style="text-align:center; padding:30px;">No games today.</div>';
            
            games.forEach(g => {
                const logo = t => `https://a.espncdn.com/i/teamlogos/nba/500/${t.toLowerCase()}.png`;
                const col = t => teamsDB[t] || '#333';
                const hProb = Math.round((g.hS/(g.hS+g.aS))*100);
                const pred = hProb > 50 ? `${g.home} %${hProb}` : `${g.away} %${100-hProb}`;
                
                let badge = `<span style="color:#aaa; font-size:0.8rem">${g.status}</span>`;
                if(g.status.includes('Q') || g.status.includes(':')) badge = `<span style="color:#d32f2f; font-weight:bold">LIVE</span> ${g.status}`;

                gCon.innerHTML += `
                    <div class="game-card">
                        <div class="matchup-row">
                            <div class="team-block" style="background:${col(g.away)}"><img src="${logo(g.away)}" class="team-logo" onerror="this.src='https://via.placeholder.com/50'"><div style="font-weight:bold; font-size:1.2rem; text-shadow:1px 1px 2px #000">${g.away}</div></div>
                            <div class="vs-block">VS</div>
                            <div class="team-block" style="background:${col(g.home)}"><img src="${logo(g.home)}" class="team-logo" onerror="this.src='https://via.placeholder.com/50'"><div style="font-weight:bold; font-size:1.2rem; text-shadow:1px 1px 2px #000">${g.home}</div></div>
                        </div>
                        <div class="odds-row"><div class="prediction-badge">ðŸ”® ${txt.labels.prediction}: ${pred}</div><div>${badge}</div></div>
                    </div>`;
            });
            
            // SakatlÄ±klarÄ± YÃ¼kle
            const inj = await fetchNBAData('injuries');
            const iBody = document.getElementById('injuries-body');
            iBody.innerHTML = '';
            inj.forEach(x => {
                iBody.innerHTML += `<tr><td><b>${x.name}</b><br><small>${x.team}</small></td><td><span style="color:${x.status==='Out'?'#ff6b6b':'#fdd835'}">${x.status}</span></td><td style="color:#888">${x.return}</td></tr>`;
            });
        }

        async function loadStats(cat) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.filter-btn').forEach(b => {if(b.getAttribute('onclick').includes(cat)) b.classList.add('active')});
            const tbody = document.getElementById('stats-body');
            tbody.innerHTML = '<tr><td colspan="4" style="text-align:center">Loading...</td></tr>';
            const stats = await fetchNBAData('stats', cat);
            tbody.innerHTML = '';
            stats.forEach(p => {
                tbody.innerHTML += `<tr><td><b>${p.r}</b></td><td><div class="player-cell"><img src="https://cdn.nba.com/headshots/nba/latest/260x190/${p.i}.png" class="player-headshot"><span>${p.n}</span></div></td><td style="color:#aaa">${p.t}</td><td class="stat-value">${p.v}</td></tr>`;
            });
        }
    </script>
</body>
</html>
