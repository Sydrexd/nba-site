<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA Pro Analytics</title>
    <style>
        /* CSS AYARLARI */
        :root { --bg: #121212; --card: #1e1e1e; --accent: #C9082A; --blue: #17408B; --text: #e0e0e0; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); }
        
        /* Header */
        header { padding: 15px 30px; background: var(--card); border-bottom: 3px solid var(--accent); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 99; }
        .logo { font-weight: 900; font-size: 1.5rem; color: #fff; } .logo span { color: var(--accent); }
        nav button { background: none; border: none; color: #aaa; font-weight: 700; padding: 10px; cursor: pointer; text-transform: uppercase; }
        nav button.active { color: #fff; border-bottom: 2px solid var(--accent); }
        
        /* Main */
        main { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .section { display: none; }
        .section.active { display: block; animation: fade 0.3s; }
        @keyframes fade { from{opacity:0} to{opacity:1} }

        /* Haberler */
        .news-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .news-card { background: var(--card); border-radius: 8px; overflow: hidden; transition: 0.3s; cursor: pointer; border: 1px solid #333; }
        .news-card:hover { transform: translateY(-5px); border-color: var(--blue); }
        .news-img { width: 100%; height: 200px; object-fit: cover; }
        .news-content { padding: 15px; }
        .news-title { font-weight: bold; font-size: 1.1rem; margin-bottom: 10px; color: #fff; }
        .news-desc { font-size: 0.9rem; color: #aaa; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }

        /* Maçlar */
        .date-picker { background: #252525; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; gap: 10px; }
        .date-input { background: #111; color: #fff; border: 1px solid #444; padding: 10px; border-radius: 4px; }
        .btn { background: var(--blue); color: #fff; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        
        .games-list { display: grid; gap: 15px; }
        .game-card { background: var(--card); padding: 20px; border-radius: 10px; border: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .team { display: flex; align-items: center; gap: 15px; width: 40%; }
        .team img { width: 50px; height: 50px; object-fit: contain; background: #fff; border-radius: 50%; padding: 2px; }
        .team-name { font-weight: bold; font-size: 1.2rem; }
        .team-score { font-size: 1.5rem; font-weight: bold; margin-left: auto; }
        .game-info { text-align: center; width: 20%; }
        .status { color: var(--accent); font-weight: bold; font-size: 0.9rem; }
        .clock { color: #888; font-size: 0.8rem; }
        
        /* Yardımcılar */
        .loading { text-align: center; padding: 50px; color: #666; font-size: 1.2rem; }
        .error { text-align: center; padding: 20px; color: #ff6b6b; }
        
        /* Stats & Injuries Placeholder */
        .coming-soon { text-align: center; padding: 50px; background: #222; border-radius: 8px; color: #aaa; }
    </style>
</head>
<body>

    <header>
        <div class="logo">NBA <span>PRO</span></div>
        <nav>
            <button onclick="show('home')" class="active" id="nav-home">Haberler</button>
            <button onclick="show('games')" id="nav-games">Maçlar</button>
            <button onclick="show('stats')" id="nav-stats">İstatistikler</button>
        </nav>
    </header>

    <main>
        <section id="home" class="section active">
            <h2 style="border-left: 4px solid var(--accent); padding-left: 10px; margin-bottom: 20px;">Gündem (ESPN Real-Time)</h2>
            <div id="news-container" class="news-grid"></div>
        </section>

        <section id="games" class="section">
            <div class="date-picker">
                <input type="date" id="game-date" class="date-input">
                <button class="btn" onclick="fetchGames()">Verileri Getir</button>
            </div>
            <div id="games-container" class="games-list"></div>
        </section>

        <section id="stats" class="section">
            <div class="coming-soon">
                <h3>İstatistik Merkezi</h3>
                <p>Gerçek veri entegrasyonu tamamlanıyor...</p>
            </div>
        </section>
    </main>

    <script>
        // Sayfa Yüklendiğinde
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('game-date').valueAsDate = new Date();
            fetchNews();
            fetchGames();
        });

        // Sekme Geçişi
        function show(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            document.getElementById('nav-'+id).classList.add('active');
        }

        // --- 1. GERÇEK HABERLER (ESPN) ---
        async function fetchNews() {
            const container = document.getElementById('news-container');
            container.innerHTML = '<div class="loading">Haberler yükleniyor...</div>';

            try {
                const res = await fetch('/api/nba?type=news');
                const data = await res.json();

                if (!data.articles || data.articles.length === 0) {
                    container.innerHTML = '<div class="error">Haber bulunamadı.</div>';
                    return;
                }

                container.innerHTML = '';
                data.articles.forEach(item => {
                    // Resim var mı kontrol et, yoksa varsayılan koy
                    const img = item.images && item.images.length > 0 ? item.images[0].url : 'https://cdn.nba.com/manage/2023/04/NBA-Playoff-Picture-2023.jpg';
                    
                    container.innerHTML += `
                        <div class="news-card" onclick="window.open('${item.links.web.href}', '_blank')">
                            <img src="${img}" class="news-img">
                            <div class="news-content">
                                <div class="news-title">${item.headline}</div>
                                <div class="news-desc">${item.description || ''}</div>
                            </div>
                        </div>
                    `;
                });
            } catch (error) {
                container.innerHTML = '<div class="error">Haber kaynağına ulaşılamadı.</div>';
                console.error(error);
            }
        }

        // --- 2. GERÇEK MAÇLAR (ESPN) ---
        async function fetchGames() {
            const date = document.getElementById('game-date').value;
            const container = document.getElementById('games-container');
            container.innerHTML = '<div class="loading">Maç verileri çekiliyor...</div>';

            try {
                const res = await fetch(`/api/nba?type=scoreboard&date=${date}`);
                const data = await res.json();

                // Veri kontrolü
                if (!data.events || data.events.length === 0) {
                    container.innerHTML = '<div class="error">Bu tarihte maç bulunamadı.</div>';
                    return;
                }

                container.innerHTML = '';
                
                data.events.forEach(event => {
                    const status = event.status.type.detail; // "Final", "Q4 - 2:00" vs
                    const comp = event.competitions[0];
                    const team1 = comp.competitors[1]; // Home (Genelde 1. index home olur ESPN'de ama kontrol edilebilir)
                    const team2 = comp.competitors[0]; // Away

                    container.innerHTML += `
                        <div class="game-card">
                            <div class="team">
                                <img src="${team2.team.logo}">
                                <div>
                                    <div class="team-name">${team2.team.abbreviation}</div>
                                    <div style="font-size:0.8rem; color:#888">${team2.records?.[0]?.summary || ''}</div>
                                </div>
                                <div class="team-score">${team2.score}</div>
                            </div>
                            
                            <div class="game-info">
                                <div class="status">${status}</div>
                                <div class="clock">${event.date.substring(11,16)} GMT</div>
                            </div>

                            <div class="team" style="flex-direction:row-reverse; text-align:right;">
                                <img src="${team1.team.logo}">
                                <div>
                                    <div class="team-name">${team1.team.abbreviation}</div>
                                    <div style="font-size:0.8rem; color:#888">${team1.records?.[0]?.summary || ''}</div>
                                </div>
                                <div class="team-score">${team1.score}</div>
                            </div>
                        </div>
                    `;
                });

            } catch (error) {
                container.innerHTML = '<div class="error">Maç verisi alınamadı.</div>';
                console.error(error);
            }
        }
    </script>
</body>
</html>
